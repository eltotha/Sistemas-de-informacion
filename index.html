<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Encuesta — Frontend (MySQL vía db.php)</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; gap:16px; align-items:center; flex-wrap:wrap">
      <div class="brand" aria-label="Inicio">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 4h18"/><path d="M7 8h10"/><rect x="3" y="10" width="18" height="10" rx="2" ry="2" />
          </svg>
        </div>
        <span>Encuesta — Demo Frontend</span>
      </div>
      <nav class="tabs no-print" role="tablist" aria-label="Navegación">
        <button class="tab" role="tab" aria-selected="true" data-view="encuestas">Encuestas</button>
        <button class="tab" role="tab" aria-selected="false" data-view="catalogos">Catálogos</button>
        <button class="tab" role="tab" aria-selected="false" data-view="usuarios">Usuarios & Roles</button>
        <button class="tab" role="tab" aria-selected="false" data-view="conexion">Conexión</button>
      </nav>
      <div class="grow"></div>
      <div class="status no-print">
        <span id="connChip" class="chip" title="Estado de la BD">DB: Desconectado</span>
        <span id="roleChip" class="chip">Rol: —</span>
        <span id="permChip" class="chip">Permisos: —</span>
        <button class="btn ghost" id="loginBtn">Iniciar sesión</button>
        <button class="btn ghost hidden" id="logoutBtn">Cerrar sesión</button>
      </div>
    </div>
  </header>

  <main>
    <section id="view-encuestas" class="grid cols-2" role="tabpanel">
      <div class="card">
        <h3>Registrar / Editar encuesta</h3>
        <p class="muted">Interfaz basada en tu esquema MySQL. Ahora guarda en MySQL usando <code>db.php</code> (sin seguridad).</p>
        <form id="formEncuesta" autocomplete="off">
          <input type="hidden" name="numero" />
          <div class="grid cols-2">
            <div><label for="I">Nombre (I) *</label><input id="I" name="I" required maxlength="30" placeholder="Benita Emelina" /></div>
            <div><label for="II">Apellido (II) *</label><input id="II" name="II" required maxlength="30" placeholder="Avendaño Arauz" /></div>
            <div><label for="III">Sexo (III) *</label><select id="III" name="III" required></select></div>
            <div><label for="IV">Identificación (IV) *</label><input id="IV" name="IV" required maxlength="20" placeholder="2811505021015U" /></div>
            <div><label for="V">Departamento (V) *</label><select id="V" name="V" required></select></div>
            <div><label for="VI">Ciudad (VI) *</label><select id="VI" name="VI" required></select></div>
            <div><label for="VII">Facultad (VII) *</label><select id="VII" name="VII" required></select></div>
            <div><label for="VIII">Carrera (VIII) *</label><select id="VIII" name="VIII" required></select></div>
            <div><label for="IX">IX (entero) *</label><input id="IX" name="IX" type="number" inputmode="numeric" required /></div>
            <div><label for="X">Matrícula (X) *</label><select id="X" name="X" required></select></div>
            <div><label for="XI">Becado (XI) *</label><select id="XI" name="XI" required></select></div>
            <div><label for="XII">XII *</label><select id="XII" name="XII" required></select></div>
            <div><label for="XIII">XIII *</label><select id="XIII" name="XIII" required></select></div>
            <div><label for="XIV">XIV *</label><select id="XIV" name="XIV" required></select></div>
            <div><label for="XV">Motivo (XV) *</label><select id="XV" name="XV" required></select></div>
            <div><label for="XVI">Gasto (XVI) *</label><select id="XVI" name="XVI" required></select></div>
            <div><label for="XVII">Mejora esperada (XVII) *</label><select id="XVII" name="XVII" required></select></div>
          </div>
          <div class="stack" style="margin-top:12px">
            <button type="submit" class="btn" id="btnGuardar">Guardar</button>
            <button type="button" class="btn ghost" id="btnCancelar">Cancelar</button>
            <div class="right"></div>
            <button type="button" class="btn ghost" id="btnCargarEjemplo">Cargar ejemplo</button>
          </div>
          <p class="muted" style="margin-top:8px">Permisos requeridos: <span class="tag">registrar_encuesta</span> / <span class="tag">actualizar_encuesta</span></p>
        </form>
      </div>
      <div class="card">
        <div class="stack">
          <h3 style="margin:0">Respuestas</h3>
          <div class="right search no-print">
            <input id="q" placeholder="Buscar por nombre, apellido o identificación…" aria-label="Buscar" />
            <button class="btn ghost" id="btnLimpiar">Limpiar</button>
            <button class="btn ghost" id="btnExportCSV" title="Exportar CSV">Exportar CSV</button>
            <button class="btn ghost" id="btnExportPDF" title="Imprimir / Guardar como PDF">Exportar PDF</button>
          </div>
        </div>
        <p class="muted">Permisos requeridos: <span class="tag">ver_encuesta</span>, <span class="tag">exportar_excel</span>, <span class="tag">exportar_pdf</span>, <span class="tag">borrar_encuesta</span></p>
        <div style="overflow:auto; max-height:60vh">
          <table id="tablaRespuestas" aria-label="Tabla de respuestas">
            <thead>
              <tr>
                <th>#</th><th>Nombre</th><th>Apellido</th><th>Sexo</th><th>Identificación</th>
                <th>Depto</th><th>Ciudad</th><th>Facultad</th><th>Carrera</th><th>IX</th>
                <th>Matrícula</th><th>Becado</th><th>XII</th><th>XIII</th><th>XIV</th>
                <th>Motivo</th><th>Gasto</th><th>Mejora</th><th class="no-print">Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="view-catalogos" class="grid cols-3 hidden" role="tabpanel" aria-hidden="true">
      <div class="card"><h3>iii_sexo</h3><ul id="cat-iii_sexo"></ul></div>
      <div class="card"><h3>v_departamento</h3><ul id="cat-v_departamento"></ul></div>
      <div class="card"><h3>vi_ciudad</h3><ul id="cat-vi_ciudad"></ul></div>
      <div class="card"><h3>vii_facultad</h3><ul id="cat-vii_facultad"></ul></div>
      <div class="card"><h3>viii_carrera</h3><ul id="cat-viii_carrera" style="max-height:50vh; overflow:auto"></ul></div>
      <div class="card"><h3>x_matricula</h3><ul id="cat-x_matricula"></ul></div>
      <div class="card"><h3>xi_becado</h3><ul id="cat-xi_becado"></ul></div>
      <div class="card"><h3>xii</h3><ul id="cat-xii"></ul></div>
      <div class="card"><h3>xiii</h3><ul id="cat-xiii"></ul></div>
      <div class="card"><h3>xiv</h3><ul id="cat-xiv"></ul></div>
      <div class="card"><h3>xv</h3><ul id="cat-xv"></ul></div>
      <div class="card"><h3>xvi</h3><ul id="cat-xvi"></ul></div>
      <div class="card"><h3>xvii</h3><ul id="cat-xvii"></ul></div>
    </section>

    <section id="view-usuarios" class="grid cols-2 hidden" role="tabpanel" aria-hidden="true">
      <div class="card">
        <h3>Usuarios</h3>
        <table id="tablaUsuarios">
          <thead><tr><th>ID</th><th>Login</th><th>Nombre</th><th>Rol</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <h3>Roles & Permisos</h3>
        <p class="muted">Basado en <code>rol_permiso</code>. En la demo afecta solo la UI.</p>
        <div id="permMatrix"></div>
        <div class="stack" style="margin-top:10px">
          <button class="btn" id="guardarPermisos">Guardar cambios</button>
          <span class="muted">Tip: inicia sesión como <b>admin</b>.</span>
        </div>
      </div>
    </section>

    <section id="view-conexion" class="grid cols-2 hidden" role="tabpanel" aria-hidden="true">
      <div class="card">
        <h3>Configurar conexión</h3>
        <p class="muted">Este frontend habla con <code>db.php</code> (PHP + mysqli). Coloca ambos archivos en tu servidor (XAMPP/WAMP/LAMP).</p>
        <div class="stack" style="margin-top:12px">
          <button type="button" class="btn" id="testConn">Probar conexión</button>
          <button type="button" class="btn ghost" id="verRaw">Ver JSON (respuestas)</button>
        </div>
      </div>
      <div class="card">
        <h3>Notas</h3>
        <pre style="white-space:pre-wrap; background:#0a1126; border:1px solid var(--border); border-radius:12px; padding:12px">
- db.php expone CRUD directo (SIN seguridad). Sólo para pruebas locales.
- Asegúrate de importar el dump y ajustar credenciales en db.php.
- Si no quieres usar PHP, necesitarás otra API que hable con MySQL.
        </pre>
      </div>
    </section>
  </main>

  <footer class="no-print">Hecho con ❤️ — Demo UI conectada a MySQL vía <code>db.php</code>.</footer>

  <dialog id="dlgLogin" style="border:none; padding:0; border-radius:16px; background:#0c1530; color:var(--text); width:min(420px, 92vw)">
  <form method="dialog" id="loginForm" style="margin:0">
    <div class="card" style="border:none">
      <h3>Iniciar sesión</h3>
      <p class="muted">Usuarios de ejemplo:</p>
      <ul class="muted" style="margin-top:0">
        <li><b>Login:</b> Bran22 — <b>Clave:</b> Bran123 (admin)</li>
        <li><b>Login:</b> Yos23 — <b>Clave:</b> Yos123 (estudiante)</li>
      </ul>
      <label>Usuario</label>
      <input name="login" placeholder="Bran22"/>
      <label>Clave</label>
      <input name="clave" type="password" placeholder="••••••"/>
      <div class="stack" style="margin-top:12px">
        <button class="btn" type="submit" value="ok">Entrar</button>
        <button class="btn ghost" type="button" id="btnCancelLogin">Cancelar</button>
      </div>
    </div>
  </form>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
</body>
</html>

